---
title: 'Connectives and cognitive control: Data analysis and visualization'
author: "Elizabeth Swanson"
date: "2023-04-26"
output: html_document
---

# Set-up

Load required packages:
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(eyetrackingR)
library(lme4)
library(readxl)
library(lmerTest)
source("helpers.R")
theme_set(theme_bw())
```

# Preparing data

## Eye-tracking data

Load eye-tracking data (make sure to unzip the .zip file if you haven't already):
```{r}
raw_eye_data = read.table('../data/conn_cog_control_timebin_1000sbefore.txt', sep = "\t", na.strings = ".", header = TRUE)
```

Prepare eye-tracking data:
```{r}
raw_eye_data$time_since_connective_onset = raw_eye_data$BIN_START_TIME - 1000
# change this if you generate timebin report starting at a point other than 1000s before connective onset

#raw_eye_data$time_since_point = raw_eye_data$BIN_START_TIME - as.numeric(raw_eye_data$rt)

raw_eye_data$participant_number = raw_eye_data$RECORDING_SESSION_LABEL
raw_eye_data$list = as.numeric(raw_eye_data$list)
```

Fix labeling of so and but conditions:
```{r}
raw_eye_data = raw_eye_data %>% mutate(condition = case_when(
  condition == "alors" ~ "so",
  condition == "mais" ~ "but"
),
condition_fr = case_when(
  condition == "so" ~ "alors",
  condition == "but" ~ "mais"
))

raw_eye_data$condition = relevel(factor(raw_eye_data$condition), ref = 'but')
```

Correct a few errors in coding explicit selection choices (all noted in comments):
```{r}
raw_eye_data$lex_related_image_selected[raw_eye_data$participant_number == 21032301 & raw_eye_data$TRIAL_LABEL == 'Trial: 9'] = 1
raw_eye_data$lex_related_image_selected[raw_eye_data$participant_number == 21032304 & raw_eye_data$TRIAL_LABEL == 'Trial: 22'] = 0
raw_eye_data$lex_related_image_selected[raw_eye_data$participant_number == 03042307 & raw_eye_data$TRIAL_LABEL == 'Trial: 17'] = 1
raw_eye_data$lex_related_image_selected[raw_eye_data$participant_number == 7042304 & raw_eye_data$TRIAL_LABEL == 'Trial: 23'] = 1
raw_eye_data$lex_related_image_selected[raw_eye_data$participant_number == 11042306 & raw_eye_data$TRIAL_LABEL == 'Trial: 13'] = 1
raw_eye_data$lex_related_image_selected[raw_eye_data$participant_number == 12042303 & raw_eye_data$TRIAL_LABEL == 'Trial: 19'] = 1
raw_eye_data$lex_related_image_selected[raw_eye_data$participant_number == 17032305 & raw_eye_data$TRIAL_LABEL == 'Trial: 16'] = 1
raw_eye_data$lex_related_image_selected[raw_eye_data$participant_number == 22032306 & raw_eye_data$TRIAL_LABEL == 'Trial: 1'] = 1
raw_eye_data$lex_related_image_selected[raw_eye_data$participant_number == 10042305 & raw_eye_data$TRIAL_LABEL == 'Trial: 1'] = 0
```


## Participant data

Load participant data:
```{r}
participant_df = read_excel('../data/participant-log-connectives-cog-control.xlsx')
participant_df = participant_df %>% type.convert(as.is = TRUE)
```

Rename age groups:
```{r}
participant_df = participant_df %>% mutate(age_group = case_when(
  age_group == '4' ~ '4-year-olds',
  age_group == '5' ~ '5-year-olds',
  age_group == '6' ~ '6-year-olds',
  age_group == 'adult' ~ 'adults'
))
```

## Flanker data

Load Flanker data:
```{r}
flanker_files = list.files(path = '../data/flanker_data', full.names = TRUE)
flanker_df = plyr::ldply(flanker_files, read_csv)
flanker_df = flanker_df %>% type.convert()
flanker_df$participant_number_fl = flanker_df$subject
```


## Merging data

Merge eye-tracking data and participant data:
```{r}
raw_eye_data = left_join(raw_eye_data, participant_df)
raw_eye_data$lex_related_image_selected = as.numeric(raw_eye_data$lex_related_image_selected)
#raw_eye_data$rt = as.numeric(raw_eye_data$rt)
```

Merge Flanker data and participant data:
```{r}
flanker_df = left_join(flanker_df, participant_df)
```

Take only children who completed novel word learning task:
```{r}
flanker_df = flanker_df %>% filter(!is.na(participant_number))
length(unique(flanker_df$participant_number_fl))
```

## Exclusions

Exclude participants who were distracted, bilingual, etc:
```{r}
eye_data = raw_eye_data %>% filter(exclude == "no")

# DELETE: exclude participants with long RTs on pointing:
#eye_data = eye_data %>% filter(as.numeric(rt) <= 10000)
```

Exclude participants who didn't complete more than half the trials:
```{r}
eye_data = eye_data %>% group_by(participant_number) %>% 
  mutate(total_trials_completed = max(TRIAL_INDEX)) %>%
  filter(total_trials_completed >= 12)
```

Check the number of participants in each age group:
```{r}
eye_data %>% group_by(participant_number) %>% filter(row_number() == 1) %>%
  group_by(age_group) %>% summarise(n = n())
```

Exclude the excluded participants from Flanker data too:
```{r}
flanker_df = flanker_df %>% filter(participant_number %in% eye_data$participant_number)
```

Write Flanker data to a separate file since we will calculate Flanker costs separately:
```{r}
write.csv(flanker_df, '../data/flanker_df.csv')
```

Flanker cost calculations are done in a separate script so load that data:
```{r}
full_flanker_df = read.csv('../data/full_flanker_df.csv')
```

## Make eye-tracking data

Make eye-tracking data:
```{r}
eye_tr_df = make_eyetrackingr_data(eye_data, 
                       participant_column = 'RECORDING_SESSION_LABEL',
                       trial_column = 'trialnumber',
                       time_column = 'time_since_connective_onset', 
                       aoi_columns = c('AVERAGE_IA_1_SAMPLE_COUNT_.',
                                       'AVERAGE_IA_2_SAMPLE_COUNT_.'),
                       treat_non_aoi_looks_as_missing = TRUE,
                       trackloss_column = 'AVERAGE_OFF_SCREEN_SAMPLE_COUNT_.'
                       )
```

### Trackloss

Remove trackloss-ridden trials:
```{r}
trackloss_clean = trackloss_analysis(data = eye_tr_df)
eye_df_clean <- clean_by_trackloss(data = eye_tr_df, trial_prop_thresh = .25)
```

Assess mean trackloss per participant:
```{r}
trackloss_clean_partic <- unique(trackloss_clean[, c('RECORDING_SESSION_LABEL','TracklossForParticipant')])
```

Get mean and SD of proportion of samples contributed per trial:
```{r}
mean(1 - trackloss_clean_partic$TracklossForParticipant)
sd(1- trackloss_clean_partic$TracklossForParticipant)
```


# Novel word learning task visualization

## Time course

Pull out test trials:
```{r}
test_df = eye_df_clean %>% filter(practicestatus == "test")
```

Create a column for accuracy on each pointing trial:
```{r}
test_df = test_df %>% 
  mutate(correct_point = case_when(
  condition == 'so' & lex_related_image_selected == 1 ~ TRUE,
  condition == 'but' & lex_related_image_selected == 0 ~ TRUE,
  TRUE ~ FALSE
  ),
  lex_related_image_pointed = case_when(
  lex_related_image_selected == TRUE ~ 'Chose related image',
  lex_related_image_selected == FALSE ~ 'Chose unrelated image'
  ))
```

Make time sequence data with age group as predictor:
```{r}
df_timecourse_age_group <- make_time_sequence_data(test_df, time_bin_size = 1, 
                                         predictor_columns = c("condition", "age_group"),
                                         aois = c("AVERAGE_IA_1_SAMPLE_COUNT_."),
                                         summarize_by = "participant_number")
```

Make time course graph by age group:
```{r}
plot(df_timecourse_age_group, predictor_column = "condition") + theme_bw() +  
  theme(text = element_text(size = 10)) +  
  geom_hline(yintercept=0.5, colour="black",size=I(0.5),show.legend = FALSE)+
  geom_vline(xintercept=0, colour="black",size=I(0.5),show.legend = FALSE) +
  ylim(0,1) +
  xlim(-1000, 4000) +
  facet_wrap(~age_group) +
  annotate("text", x=-150, y=.9, label="connective \nonset", size = 2) +
  xlab("Time since connective onset (ms)") +
  ylab("Proportion of looks to lexically related image") +
  ggtitle("Proportion of looks to lexically related image by condition")

ggsave('timecourse_age_group.pdf', path = '../graphs', height = 6, width = 10)
```

Make time sequence data with child/adult group as predictor:
```{r}
df_timecourse_child_adult_group <- make_time_sequence_data(test_df, time_bin_size = 1, 
                                         predictor_columns = c("condition",
                                                               "child_adult_group"),
                                         aois = c("AVERAGE_IA_1_SAMPLE_COUNT_."),
                                         summarize_by = "participant_number")

```

Make time course graph for children vs. adults:
```{r}
plot(df_timecourse_child_adult_group, predictor_column = "condition") + theme_bw() +  
  theme(text = element_text(size = 10)) +  
  geom_hline(yintercept=0.5, colour="black",size=I(0.5),show.legend = FALSE)+
  geom_vline(xintercept=0, colour="black",size=I(0.5),show.legend = FALSE) +
  ylim(0,1) +
  xlim(-500, 4000) +
  facet_wrap(~child_adult_group) +
  annotate("text", x=-150, y=.9, label="connective \nonset", size = 2.5) +
  xlab("Time since connective onset (ms)") +
  ylab("Proportion of looks to lexically related image") +
  ggtitle("Proportion of looks to lexically related image by condition")

ggsave('timecourse_child_adult.pdf', path = '../graphs', height = 6, width = 10)
```

Make time sequence data with child/adult group and correct/incorrect point as predictors:
```{r}
df_timecourse_pointing_child_adult <- make_time_sequence_data(test_df, time_bin_size = 1, 
                                         predictor_columns = c("condition",
                                                               "child_adult_group",
                                                               "lex_related_image_pointed"),
                                         aois = c("AVERAGE_IA_1_SAMPLE_COUNT_."),
                                         summarize_by = "participant_number")

```

Make time course graph for children vs. adults and correct vs. incorrect points:
```{r}
plot(df_timecourse_pointing_child_adult, predictor_column = "condition") + theme_bw() +  
  theme(text = element_text(size = 10)) +  
  geom_hline(yintercept=0.5, colour="black",size=I(0.5),show.legend = FALSE)+
  geom_vline(xintercept=0, colour="black",size=I(0.5),show.legend = FALSE) +
  ylim(0,1) +
  xlim(-500, 4000) +
  facet_grid(rows = vars(lex_related_image_pointed), cols = vars(child_adult_group)) +
  annotate("text", x=-150, y=.9, label="connective \nonset", size = 2.5) +
  xlab("Time since connective onset (ms)") +
  ylab("Proportion of looks to lexically related image") +
  ggtitle("Proportion of looks to lexically related image by condition")

ggsave('timecourse_pointing_child_adult.pdf', path = '../graphs', height = 6, width = 10)
```


## Cluster analysis

Separate time course data into children vs. adults:
```{r}
df_timecourse_children = test_df %>% 
  filter(child_adult_group == "child") %>%
  make_time_sequence_data(time_bin_size = 1, predictor_columns = c("condition"),
                                         aois = c("AVERAGE_IA_1_SAMPLE_COUNT_."),
                                         summarize_by = "participant_number")

df_timecourse_adult = test_df %>% 
  filter(child_adult_group == "adult") %>%
  make_time_sequence_data(time_bin_size = 1, predictor_columns = c("condition"),
                                         aois = c("AVERAGE_IA_1_SAMPLE_COUNT_."),
                                         summarize_by = "participant_number")
```

Make time cluster data for children:
```{r}
df_timeclust_children = make_time_cluster_data(df_timecourse_children,
                                      test = "t.test",
                                      predictor_column = "condition",
                                      aoi = "AVERAGE_IA_1_SAMPLE_COUNT_.",
                                      threshold = 1.5,
                                      formula = ArcSin ~ condition)
```

Summarize time cluster analysis for children:
```{r}
summary(df_timeclust_children)
```

Plot time cluster data for children:
```{r}
plot(df_timeclust_children, predictor_column = "condition") + theme_bw() +  
  theme(text = element_text(size = 10)) + 
  geom_hline(yintercept=0.5, colour="black",size=I(0.5),show.legend = FALSE) +
  geom_vline(xintercept=0, colour="black",size=I(1.5),show.legend = FALSE) +
  xlab("Time since connective onset (ms)") +
  ylab("Cluster T test statistic") +
  ggtitle("T test statistic for difference in looks to lexically related image by condition:\n Children")

ggsave('timecluster_children.pdf', path = '../graphs', height = 4, width = 6)
```

Make time cluster data for adults:
```{r}
df_timeclust_adult = make_time_cluster_data(df_timecourse_adult,
                                      test= "t.test",
                                      predictor_column = "condition",
                                      aoi = "AVERAGE_IA_1_SAMPLE_COUNT_.",
                                      threshold = 1.5,
                                      formula = ArcSin ~ condition)
```

Summarize time cluster analysis for adults:
```{r}
summary(df_timeclust_adult)
```

Plot time cluster data for adults:
```{r}
plot(df_timeclust_adult, predictor_column = "condition") + theme_bw() +  
  theme(text = element_text(size = 10)) + 
  geom_hline(yintercept=0.5, colour="black",size=I(0.5),show.legend = FALSE) +
  geom_vline(xintercept=0, colour="black",size=I(1.5),show.legend = FALSE) +
  xlab("Time since connective onset (ms)") +
  ylab("Cluster T test statistic") +
  ggtitle("T test statistic for difference in looks to lexically related image by condition:\n Adults")

ggsave('timecluster_adult.pdf', path = '../graphs', height = 4, width = 6)
```

## Explicit selection data

Create dataframe with one row per trial per participant and calculate participant's proportion of trials per condition with lexically related image selected:
```{r}
test_df_trial = test_df %>% group_by(participant_number, TRIAL_LABEL) %>%
  filter(row_number() == 1) %>%
  group_by(participant_number, condition) %>%
  mutate(partic_cond_trial_num = n(),
         partic_prop_lex_related_image_selected =
           mean(na.omit(lex_related_image_selected)))
```

Create data frame with one row per participant per condition:
```{r}
test_df_participant = test_df_trial %>% group_by(participant_number, condition) %>%
  filter(row_number() == 1)
```

Summarize number of trials on each condition for which participants selected the lexically related image:
```{r}
selection_summ = test_df_participant %>%
  group_by(condition, age_group) %>%
  summarise(n = n(), 
            mean_prop_lex_related_image_selected =
              mean(partic_prop_lex_related_image_selected),
            CI.low = ci.low(partic_prop_lex_related_image_selected),
            CI.high = ci.high(partic_prop_lex_related_image_selected)) %>%
  mutate(YMin = mean_prop_lex_related_image_selected - CI.low, 
         YMax = mean_prop_lex_related_image_selected + CI.high)
```

Graph proportion of trials on each condition for which participants selected the lexically related image, by age group:
```{r}
ggplot(selection_summ) +
  theme_bw() +
  aes(x = condition, y = mean_prop_lex_related_image_selected, fill = condition) +
  facet_wrap(~age_group) +
  geom_bar(stat = "identity", position = position_dodge2(preserve = "single")) + 
  geom_jitter(data = test_df_participant, aes(x = condition, y = partic_prop_lex_related_image_selected), 
              shape = 21, size = 1, width = 0.2, height = 0, stroke = 0.4, alpha = 0.3) +
  geom_errorbar(aes(ymin = YMin, ymax = YMax), width = .2, position = position_dodge(.9)) +
  scale_fill_discrete(name = "Condition") +
  scale_y_continuous(limits = c(0, 1.06), oob = scales::squish) +
  ggtitle("Proportion of trials with lexically related image selected by condition") +
  xlab("Condition") +
  ylab("Proportion of trials with lexically related image selected")

ggsave('selection_age_group_bar.pdf', path = '../graphs', height = 4, width = 6)
```

Line graph of proportion of trials on each condition for which participants selected the lexically related image, by age group:
```{r}
ggplot(selection_summ) +
  theme_bw() +
  aes(x = age_group, y = mean_prop_lex_related_image_selected, group = condition, color = condition) +
  geom_line() + 
  geom_point() +
  ylim(0,1.05) +
  geom_hline(yintercept=0.5, colour="black",linetype = 3, size=I(1),show.legend = FALSE)+
  geom_errorbar(aes(ymin = YMin, ymax = YMax), width = .2) +
  scale_color_discrete(name = "Condition") +
  ggtitle("Proportion of trials with lexically related image selected by age group") +
  xlab("Age group") +
  ylab("Proportion of trials with lexically related image selected")

ggsave('selection_age_group_line.pdf', path = '../graphs', height = 4, width = 6)
```

# Novel word learning task analysis

## Pointing data

Run a mixed model to see if condition predicts pointing to lexically related image:
```{r}
pointing_lm = lmer(lex_related_image_selected ~ condition +
                     (1|participant_number) + (1|novelword), 
                   data = test_df_trial)
summary(pointing_lm)
```

Run a mixed model to see if condition and age (in months) predict pointing to lexically related image:
```{r}
pointing_age_lm = lmer(lex_related_image_selected ~ condition + age_months +
                     (1|participant_number) + (1|novelword), 
                   data = test_df_trial)
summary(pointing_age_lm)
```

## Proportion of looks

Pull out looking data during window where there was a significant time cluster (change start time to 0 and end time to 4000 if you want to examine full window after connective onset):
```{r}
window_test_df = subset_by_window(test_df, 
                                  window_start_time = 900,
                                  window_end_time = 2081)

# change start time to 0 and end time to 4000 if you want to examine full window after connective onset
```

Calculate each participant's mean proportion of looks to the lexically related image over the trial:
```{r}
window_test_df_partic = make_time_window_data(window_test_df, 
                                              aois = 'AVERAGE_IA_1_SAMPLE_COUNT_.',
                                              predictor_columns = c("condition", "age_group",
                                                                    "child_adult_group"), 
                                              summarize_by = "participant_number")
```

Plot raw prop looking data by age group:
```{r}
plot(window_test_df_partic, predictor_columns = c("condition"), dv = "Prop") + theme_bw() +
  facet_wrap(~age_group) +
  ylim(0,1) +
  xlab("Condition") +
  ylab("Proportion of looks to lexically related image") +
  ggtitle("Proportion of looks to lexically related image by condition")

ggsave('prop_looks_age_group.pdf', path = '../graphs', height = 6, width = 8)
```

Plot raw prop looking data for children vs. adults:
```{r}
plot(window_test_df_partic, predictor_columns = c("condition"), dv = "Prop") + theme_bw() +
  facet_wrap(~child_adult_group) +
  ylim(0,1) +
  xlab("Condition") +
  ylab("Proportion of looks to lexically related image") +
  ggtitle("Proportion of looks to lexically related image by condition")

ggsave('prop_looks_child_adult_group.pdf', path = '../graphs', height = 6, width = 8)
```

Pull out just ArcSin-transformed prop of looks for adults and children:
```{r}
prop_looks_partic_child = window_test_df_partic %>% select(participant_number, condition, age_group, child_adult_group, ArcSin) %>% filter(child_adult_group == 'child') %>%
  spread(key = 'condition', value = 'ArcSin') %>%
  rename(arcsin_prop_looks_but = but, arcsin_prop_looks_so = so)

prop_looks_partic_adult = window_test_df_partic %>% select(participant_number, condition, age_group, child_adult_group, ArcSin) %>% filter(child_adult_group == 'adult') %>%
  spread(key = 'condition', value = 'ArcSin') %>%
  rename(arcsin_prop_looks_but = but, arcsin_prop_looks_so = so)
```

T test to see if there is a significant difference in proportion of looks to lexically related image by condition for children:
```{r}
t.test(prop_looks_partic_child$arcsin_prop_looks_so, prop_looks_partic_child$arcsin_prop_looks_but, paired = TRUE)
t.test(prop_looks_partic_adult$arcsin_prop_looks_so, prop_looks_partic_adult$arcsin_prop_looks_but, paired = TRUE)
```
Both children and adults looked significantly more at the lexically related image in the so condition than the but condition.

Make a version of data with CORRECT looks on so and but trials:
```{r}
window_test_df_partic_acc = make_time_window_data(window_test_df, 
                                              aois = c('AVERAGE_IA_1_SAMPLE_COUNT_.',
                                                       'AVERAGE_IA_2_SAMPLE_COUNT_.'),
                                              predictor_columns = c("condition", "age_group",
                                                                    "child_adult_group"), 
                                              summarize_by = "participant_number")
```

Pull out only prop of looks to CORRECT image:
```{r}
window_test_df_partic_acc = window_test_df_partic_acc %>% 
  filter((condition == 'so' & AOI == 'AVERAGE_IA_1_SAMPLE_COUNT_.') |
           (condition == 'but' & AOI == 'AVERAGE_IA_2_SAMPLE_COUNT_.'))
```

Pull out just raw prop of looks to correct image for adults and children (we will use this for the relationship to Flanker data later):
```{r}
prop_looks_acc_partic_child = window_test_df_partic_acc %>% 
  select(participant_number, condition, age_group, child_adult_group, Prop) %>%
  filter(child_adult_group == 'child') %>%
  spread(key = 'condition', value = 'Prop') %>%
  rename(prop_correct_looks_but = but, prop_correct_looks_so = so)

prop_looks_acc_partic_adult = window_test_df_partic_acc %>% 
  select(participant_number, condition, age_group, child_adult_group, Prop) %>%
  filter(child_adult_group == 'adult') %>%
  spread(key = 'condition', value = 'Prop') %>%
  rename(prop_correct_looks_but = but, prop_correct_looks_so = so)
```

## Relationship of Flanker performance and pointing performance

Create a column for accuracy on pointing trials:
```{r}
pointing_df_participant = test_df_participant %>% 
  mutate(partic_prop_correct_points = case_when(
  condition == 'so' ~ partic_prop_lex_related_image_selected,
  condition == 'but' ~ (1 - partic_prop_lex_related_image_selected)))
```

We will only be analyzing children, as adults did not complete the Flanker task:
```{r}
pointing_df_participant = pointing_df_participant %>% filter(child_adult_group == 'child')
```

Calculate participants' proportion of correct points on so and but trials:
```{r}
pointing_df_participant = pointing_df_participant %>% 
  group_by(participant_number, condition) %>%
  summarise(partic_prop_correct_points = partic_prop_correct_points,
            participant_number_fl = participant_number_fl,
            age_group = age_group,
            age_months = age_months)
```

Reshape to create dataframe with one row per participant:
```{r}
pointing_df_participant = pointing_df_participant %>% 
  spread(key = 'condition', value = 'partic_prop_correct_points') %>%
  rename(prop_correct_points_but = but, prop_correct_points_so = so)
```

Merge with Flanker data:
```{r}
pointing_df_participant = right_join(pointing_df_participant, full_flanker_df)
```

Change proportion correct points for but to z-scores:
```{r}
pointing_df_participant$mean_prop_correct_points_but = mean(pointing_df_participant$prop_correct_points_but)
pointing_df_participant$sd_prop_correct_points_but = sd(pointing_df_participant$prop_correct_points_but)

pointing_df_participant = pointing_df_participant %>% 
  mutate(prop_correct_points_but_z_score = ((prop_correct_points_but - mean_prop_correct_points_but)/sd_prop_correct_points_but))
```

Change proportion correct points for so to z-scores:
```{r}
pointing_df_participant$mean_prop_correct_points_so = mean(pointing_df_participant$prop_correct_points_so)
pointing_df_participant$sd_prop_correct_points_so = sd(pointing_df_participant$prop_correct_points_so)

pointing_df_participant = pointing_df_participant %>% 
  mutate(prop_correct_points_so_z_score = ((prop_correct_points_so - mean_prop_correct_points_so)/sd_prop_correct_points_so))
```

Run a regression to test whether Flanker performance predicts performance on but trials:
```{r}
fl_pointing_lm = lm(prop_correct_points_but_z_score ~ composite_congruency_effect + composite_switch_effect + flanker_nogo_effect_z_score + age_months_z_score + prop_correct_points_so_z_score, 
                    data = pointing_df_participant)
summary(fl_pointing_lm)
```

Try without combining RT and acc z-scores:
```{r}
fl_pointing_separate_lm = lm(prop_correct_points_but_z_score ~ flanker_congruency_rt_z_score + flanker_congruency_acc_z_score + flanker_switch_rt_z_score + flanker_switch_acc_z_score +  flanker_nogo_effect_z_score + age_months_z_score + prop_correct_points_so_z_score, 
                             data = pointing_df_participant)
summary(fl_pointing_separate_lm)
```


## Relationship of Flanker performance and looking to correct image

Merge Flanker data and proportion of looks data:
```{r}
prop_looks_acc_partic_fl = left_join(prop_looks_acc_partic_child, participant_df)
prop_looks_acc_partic_fl = right_join(prop_looks_acc_partic_fl, full_flanker_df)
```

Calculate z-score for proportion of looks to correct image on so trials:
```{r}
prop_looks_acc_partic_fl$mean_prop_correct_looks_so = mean(prop_looks_acc_partic_fl$prop_correct_looks_so)
prop_looks_acc_partic_fl$sd_prop_correct_looks_so = sd(prop_looks_acc_partic_fl$prop_correct_looks_so)

prop_looks_acc_partic_fl = prop_looks_acc_partic_fl %>% 
  mutate(prop_correct_looks_so_z_score = ((prop_correct_looks_so - mean_prop_correct_looks_so)/sd_prop_correct_looks_so))
```

Calculate z-score for proportion of looks to correct image on but trials:
```{r}
prop_looks_acc_partic_fl$mean_prop_correct_looks_but = mean(prop_looks_acc_partic_fl$prop_correct_looks_but)
prop_looks_acc_partic_fl$sd_prop_correct_looks_but = sd(prop_looks_acc_partic_fl$prop_correct_looks_but)

prop_looks_acc_partic_fl = prop_looks_acc_partic_fl %>% 
  mutate(prop_correct_looks_but_z_score = ((prop_correct_looks_but - mean_prop_correct_looks_but)/sd_prop_correct_looks_but))
```

Run a regression to test whether Flanker performance predicts looking performance on but trials:
```{r}
fl_looking_lm = lm(prop_correct_looks_but_z_score ~ composite_congruency_effect + composite_switch_effect + flanker_nogo_effect_z_score + age_months_z_score + prop_correct_looks_so_z_score, data = prop_looks_acc_partic_fl)
summary(fl_looking_lm)
```

Try without combining RT and acc z-scores:
```{r}
fl_looking_separate_lm = lm(prop_correct_looks_but_z_score ~ flanker_congruency_rt_z_score + flanker_congruency_acc_z_score + flanker_switch_rt_z_score + flanker_switch_acc_z_score +  flanker_nogo_effect_z_score + age_months_z_score + prop_correct_looks_so_z_score, data = prop_looks_acc_partic_fl)
summary(fl_looking_separate_lm)
```

Try without performance on so trials as a predictor, with composites:
```{r}
fl_looking_no_so_lm = lm(prop_correct_looks_but_z_score ~ composite_congruency_effect + composite_switch_effect + flanker_nogo_effect_z_score + age_months_z_score, data = prop_looks_acc_partic_fl)
summary(fl_looking_no_so_lm)
```

Try without combining RT and acc z-scores and without performance on so trials:
```{r}
fl_looking_separate_no_so_lm = lm(prop_correct_looks_but_z_score ~ flanker_congruency_rt_z_score + flanker_congruency_acc_z_score + flanker_switch_rt_z_score + flanker_switch_acc_z_score +  flanker_nogo_effect_z_score + age_months_z_score, data = prop_looks_acc_partic_fl)
summary(fl_looking_separate_no_so_lm)
```




